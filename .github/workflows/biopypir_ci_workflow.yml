---
name: BIOPYPIR-APPROVED
on: [push,pull_request] 
jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        python-version: [3.6,3.7] 
        os: [macOS-latest, ubuntu-latest] 
    env: 
      REPO: ${{ github.repository }}
      WORKSPACE: ${{ github.workspace }}
    steps:
    - name: STEP 1. Check-Out Repo 
      uses: actions/checkout@v2     
    #===============================================#
    - name: STEP 2. Set-Up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
        
    #===============================================#
    - name: STEP 3. Install dependencies
      run: |
        pwd
        pip install --upgrade pip setuptools wheel
        pip install --no-binary :all: nmslib
        pip install .
        pip install pytest
        pip install python-coveralls
        pip install coveralls
        pip install junit2html
        pip install pytest-cov
        
    - name: simple linter
      id: linter
      run: pylint "$WORKSPACE" --exit-zero --reports=y | > pylint-report.txt
    #===============================================#
    - name: test build status
      run: python setup.py build
    #===============================================#
    - name: simple pytest
      run: pytest -rs --color=yes -m "not pandoc_version_sensitive"
    #run: pytest "$WORKSPACE/tests/" --color=yes --cov=manubot
    - name: STEP 6. Run Coveralls 
      env:
        COVERALLS_REPO_TOKEN: ${{ secrets.COVERALLS_REPO_TOKEN }}
        COVERALLS_PARALLEL: true
      run: coveralls
   #===============================================#
    - name: coveralls finish
      uses: coverallsapp/github-action@master
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        parallel-finished: true
    #===============================================#
    - name: STEP 7. Zip Artifacts
      run: |
        zip artifacts.zip coverage-report.html pylint-report.txt
    #===============================================#
    - name: Upload artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: artifacts.zip
        path: artifacts.zip
        
      
